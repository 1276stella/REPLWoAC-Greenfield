<ion-view view-title="Report Crash">


  <div class='step-container container-progress'>
    <div class='step' ng-class="{ 'active' : eventCl.currentStep >= 1 }" data-step='1'>1</div>
    <div class='step-separator' ng-class="{ 'active' : eventCl.currentStep >= 2 }" data-step='1'></div>
    <div class='step' ng-class="{ 'active' : eventCl.currentStep >= 2 }" data-step='2'>2</div>
    <div class='step-separator' ng-class="{ 'active' : eventCl.currentStep >= 3 }" data-step='2'></div>
    <div class='step' ng-class="{ 'active' : eventCl.currentStep >= 3 }" data-step='3'>3</div>

    <div class='step-separator' ng-class="{ 'active' : eventCl.currentStep >= 4 }" data-step='3'></div>
    <div class='step' ng-class="{ 'active' : eventCl.currentStep >= 4 }" data-step='4'>4</div>

  </div>


  <ion-nav-buttons side="right">
    <button class="button button-clear button-light" ng-show="eventCl.index === 1" ng-click="eventCl.getPhoto()"><i class="icon ion-ios-camera"></i></button>
  </ion-nav-buttons>

  <ion-nav-bar class="bar-positive"></ion-nav-bar>
  <ion-slide-box on-slide-changed="eventCl.slideChanged(index)">



    <!-- Add Witness -->
    <ion-slide ng-controller="EventWitnessController as witnessCl">
      <ion-content>

      <div class="item item-button-right">
        Call Police
        <button class="button button-assertive">
          <i class="icon ion-ios-telephone"></i>
        </button>
      </div>

      <div class="list list-inset">

        <p>Check on the other driver's status. If injured, please call 911 immediately.</p>
        <p>Check for witnesses. Ask for their information. If there is no witnesses, please click next.</p>

        <label class="item item-input">
          <input type="text" placeholder="First Name" ng-model="witnessCl.person.fname">
        </label>
        <label class="item item-input">
          <input type="text" placeholder="Last Name" ng-model="witnessCl.person.lname">
        </label>
        <label class="item item-input">
          <input type="text" placeholder="Phone Number" ng-model="witnessCl.person.phone">
        </label>
        <label class="item item-input">
          <input type="text" placeholder="Email Address" ng-model="witnessCl.person.email">
        </label>
        <label class="item item-input">
          <textarea placeholder="Comments" ng-model="witnessCl.person.comments"></textarea>
        </label>

        <button class="button button-full button-positive" ng-click="witnessCl.addWitness()">Add Witness</button>

        <!-- Create a Card Out of Each Added Witness, the card should be editable as well -->
        <div class="card" ng-repeat="witness in witnessCl.witnessArr">
          <div class="item item-divider">
            {{witness.fname}} {{witness.lname}}
          </div>
          <div class="item item-text-wrap">
            {{witness.phone}}
            {{witness.email}}
            {{witness.comments}}
          </div>
        </div>
      </div>

      </ion-content>
    </ion-slide>

    <!-- Take Photos -->
    <ion-slide ng-controller="EventPhotoController as photoCl">

      <!-- MOBILE VERSION -->
<!--       <img ng-src="{{photoCl.lastPhoto}}" style="max-width: 100%"> -->

      <!-- BROWSER VERSION -->
      <div class="camera">
        <video id="video">Video stream not available</video>
        <button ng-click="takePhoto()">Take photo</button>
      </div>

      <canvas ng-show="crashPhotoCtrl.streaming" id="canvas"></canvas>

      <div class="output">
        <img id="photo" alt="The screen capture will appear in this box">
      </div>


    </ion-slide>

    <!-- Add Other User -->
    <ion-slide ng-controller="EventPersonController as personCl">
      <ion-content ng-init="personCl.getAllUsers()">

      <!--
        Lookup the User by username
        Need to retreive all users from the database to search for them by name
        Click on the username fire this function
      -->
      <ion-toggle ng-model="personCl.enterManual" ng-checked="personCl.enterManual">
        Enter Person Information Manually?
      </ion-toggle>

      <label class="item item-input" ng-show="!personCl.enterManual">
        <i class="icon ion-search placeholder-icon"></i>
        <input type="text" placeholder="Username" ng-model="query">
      </label>

      <div class="list">
        <div class="item item-divider" ng-show="!personCl.enterManual">
          Users
        </div>

        <a class="item item-avatar" href="#" ng-show="!personCl.enterManual" ng-repeat="user in personCl.allUsers | orderBy : 'username' | filter : query | limitTo : 10" ng-click="personCl.getUser(user.username)">
          <img src="img/crashProfile2.jpg">
          <h2>{{user.username}}</h2>
          <p>{{user.fname}} {{user.lname}}</p>
        </a>

      </div>

      <!-- Manually enter the user, this should be hidden until prompted -->
      <div class="list list-inset" ng-show="personCl.enterManual">

        <label class="item item-input">
          <input type="text" class="form-control" placeholder="First Name" ng-model="eventFCl.crashDriver.fname">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="DOB" ng-model="eventFCl.crashDriver.dob">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="Phone Number" ng-model="eventFCl.crashDriver.phone">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="Email Address" ng-model="eventFCl.crashDriver.email">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="Driver License Number" ng-model="eventFCl.crashDriver.license">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="Driver License State" ng-model="eventFCl.crashDriver.licenseState">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder
         ="Insurance Company" ng-model="eventFCl.crashDriver.insurance">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="Insurance Policy Number" ng-model="eventFCl.crashDriver.policy">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="Agent Name" ng-model="eventFCl.crashDriver.agent">
        </label>
        <label class="item item-input">
          <input type="text" class="form-control" placeholder="Agent Email" ng-model="eventFCl.crashDriver.agentEmail">
        </label>

        <button class="button button-full button-positive" ng-click="personCl.save()">Add Driver</button>

      </div>

      </ion-content>
    </ion-slide>

    <!-- Review All Information before Saving -->
    <ion-slide ng-controller="EventFinalController as eventFCl">
    <!-- This is a dummy, if the index is 3 it calls the function -->
    <div ng-if="eventCl.index === 3" ng-init="eventFCl.load()"></div>
      <ion-content>

      <!-- Witnesses -->
      <div class="item item-divider" ng-show="eventFCl.witnessArr.length !== 0">
        <i class="icon ion-ios-people"></i>
        Witnesses
      </div>

      <!-- If no witnesses have been added -->
      <div class="card" ng-show="eventFCl.witnessArr.length === 0">
        <div class="item item-divider item-text-wrap">
          No Witnesses
        </div>
      </div>

      <!-- Witnesses -->
      <div class="card" ng-repeat="person in eventFCl.witnessArr">
        <div class="item item-divider">
          Witness #{{ $index + 1 }}
        </div>
        <div class="item item-text-wrap">
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="First Name" ng-model="person.fname">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Last Name" ng-model="person.lname">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Phone Number" ng-model="person.phone">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Email Address" ng-model="person.email">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Comments" ng-model="person.comments">
          </label>
        </div>
        <div class="item item-divider">
          Edit
        </div>
      </div>

      <!-- Crash Images Secion -->
      <div class="item item-divider">
        <i class="icon ion-camera"></i>
        Crash Images
      </div>

      <!-- If no crash images have been added -->
      <div class="card" ng-show="eventFCl.eventImages.length === 0">
        <div class="item item-divider item-text-wrap">
          No Images Added
        </div>
      </div>

      <!-- Crash Images -->
      <div class="list card">
        <div class="item item-body">
          <img class="full-image" ng-repeat="image in eventFCl.eventImages" src="{{image}}">
        </div>
      </div>

      <!-- Crash Images Secion -->
      <div class="item item-divider">
        <i class="icon ion-model-s"></i>
        Persons Involved in Accident
      </div>

      <!-- If no other drivers have been added -->
      <div class="card" ng-show="eventFCl.crashDriver === undefined">
        <div class="item item-divider item-text-wrap">
          No Other Driver Added
        </div>
      </div>

      <!-- Other Driver's Information -->
      {{eventFCl.CrashEventObj}}
      <div class="card" ng-show="eventFCl.crashDriver !== undefined">
<!--         <div class="item item-divider">
          Other Driver
        </div>
        <div class="item item-text-wrap"> -->
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="First Name" ng-model="eventFCl.crashDriver.fname">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="DOB" ng-model="eventFCl.crashDriver.dob">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Phone Number" ng-model="eventFCl.crashDriver.phone">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Email Address" ng-model="eventFCl.crashDriver.email">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Driver License Number" ng-model="eventFCl.crashDriver.license">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Driver License State" ng-model="eventFCl.crashDriver.licenseState">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder
           ="Insurance Company" ng-model="eventFCl.crashDriver.insurance">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Insurance Policy Number" ng-model="eventFCl.crashDriver.policy">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Agent Name" ng-model="eventFCl.crashDriver.agent">
          </label>
          <label class="item item-input">
            <input type="text" class="form-control" placeholder="Agent Email" ng-model="eventFCl.crashDriver.agentEmail">
          </label>
        <!-- </div> -->
      </div>

      <!-- This should be disabled if no driver has been added -->
      <button class="button button-full button-positive" ng-click="eventFCl.save()">Save</button>

      </ion-content>
    </ion-slide>

  </ion-slide-box>
</ion-view>
