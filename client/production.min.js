angular.module("crash",["crash.eventService","crash.userService","crash.S3","crash.crashEventObj","crash.profile","crash.createAccount","crash.signIn","crash.history","crash.crashWitness","crash.crashPhoto","crash.crashDriverSearch","crash.crashDriverInfo","crash.crashEmail","crash.crashFinalInfo","ngRoute","ngCookies"]).config(function(a,b){a.when("/",{templateUrl:"scripts/modules/crash/crashWitness/crashWitness.html",controller:"CrashWitnessController",controllerAs:"crashWitnessCtrl",data:{authenticate:!0}}).when("/profile",{templateUrl:"scripts/modules/user/profile/profile.html",controller:"ProfileController",controllerAs:"profileCtrl",data:{authenticate:!0}}).when("/signin",{templateUrl:"scripts/modules/user/signin/signIn.html",controller:"SignInController",controllerAs:"signInCtrl",data:{authenticate:!1}}).when("/createAccount",{templateUrl:"scripts/modules/user/createAccount/createAccount.html",controller:"CreateAccountController",controllerAs:"createAccountCtrl",data:{authenticate:!1}}).when("/history",{templateUrl:"scripts/modules/history/history.html",controller:"HistoryController",controllerAs:"historyCtrl",data:{authenticate:!0}}).when("/crashPhoto",{templateUrl:"scripts/modules/crash/crashPhoto/crashPhoto.html",controller:"CrashPhotoController",controllerAs:"crashPhotoCtrl",data:{authenticate:!0}}).when("/crashDriverSearch",{templateUrl:"scripts/modules/crash/crashDriverSearch/crashDriverSearch.html",controller:"CrashDriverSearchController",controllerAs:"crashDriverSearchCtrl",data:{authenticate:!0}}).when("/crashDriverInfo",{templateUrl:"scripts/modules/crash/crashDriverInfo/crashDriverInfo.html",controller:"CrashDriverInfoController",controllerAs:"crashDriverInfoCtrl",data:{authenticate:!0}}).when("/crashEmail",{templateUrl:"scripts/modules/crash/crashEmail/crashEmail.html",controller:"CrashEmailController",controllerAs:"crashEmailCtrl",data:{authenticate:!0}}).when("/crashFinalInfo",{templateUrl:"scripts/modules/crash/crashFinalInfo/crashFinalInfo.html",controller:"CrashFinalInfoController",controllerAs:"crashFinalInfoCtrl",data:{authenticate:!0}}).when("/authFacebook",{templateUrl:"scripts/modules/user/profile/profile.html",controller:"ProfileController",controllerAs:"profileCtrl",data:{authenticate:!0}}).otherwise({redirectTo:"/"}),b.interceptors.push("AttachToken")}).factory("AttachToken",function(a){return{request:function(b){var c=a.localStorage.getItem("com.crash");return c&&(b.headers["x-access-token"]=c),b.headers["Allow-Control-Allow-Origin"]="*",b}}}).run(function(a,b,c){a.$on("$routeChangeStart",function(a,d,e){d.$$route&&d.data.authenticate&&!c.isAuthorized()&&b.path("/signin")})}),angular.module("crash.crashEventObj",[]).service("CrashEventObj",function(){this.crashEvent={}}),angular.module("crash.eventService",[]).factory("EventService",function(a){var b=function(b){return a({method:"POST",url:"api/event/create",data:b}).then(function(a){return a.data})},c=function(b){return a({method:"GET",url:"api/event/read"}).then(function(a){return a.data})};return{createCrashEvent:b,readCrashEvent:c}}),angular.module("crash.S3",[]).factory("S3Service",function(a){var b=function(b,c){return a({method:"POST",url:"api/s3/upload",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({imgName:c,imageData:b})}).then(function(a){return a.data})};return{uploadImage:b}}),angular.module("crash.userService",[]).factory("UserService",function(a,b,c){var d=function(b){return a({method:"POST",url:"api/user/signin",data:b}).then(function(a){return a.data})},e=function(){return a({method:"GET",url:"api/auth/facebook"}).then(function(a){return a.data})},f=function(b){return a({method:"POST",url:"api/user/create",data:b}).then(function(a){return a.data})},g=function(){return a({method:"GET",url:"api/userAction/read"}).then(function(a){return a.data})},h=function(b){return a({method:"POST",url:"api/user/updateuser",data:b}).then(function(a){return a.data})},i=function(b){return a({method:"GET",url:"api/user/read",params:{username:b}}).then(function(a){return a.data})},j=function(){return!!b.localStorage.getItem("com.crash")},k=function(){b.localStorage.clear(),c.path("/signin")};return{signin:d,signinFacebook:e,createAccount:f,updateUserAccount:h,readAccount:g,signout:k,isAuthorized:j,getAccountByUsername:i}}),angular.module("crash.crashDriverInfo",[]).controller("CrashDriverInfoController",function(a){var b=this;b.person={},b.personMaster={firstname:"",lastname:"",dob:"",phoneNumber:"",email:"",driverLicenseNum:"",insuranceCompany:"",policyNum:"",agentName:"",agentEmail:""},b.save=function(){console.log("saving..."),a.crashEvent.crashDriver=b.person,b.person=b.personMaster}}),angular.module("crash.crashDriverSearch",[]).controller("CrashDriverSearchController",function(a,b){var c=this;c.errorMessage="",c.crashDriver={},c.getUser=function(){var d=c.username;a.getAccountByUsername(d).then(function(a){c.crashDriver=a,b.crashEvent.crashDriver=c.crashDriver,console.log("crash event object : ",b.crashEvent)})["catch"](function(a){console.log("user not received...",a.data),c.errorMessage=a.data.error})}}),angular.module("crash.crashEmail",[]).controller("CrashEmailController",function(a){var b=this;b.person={},b.getUser=function(){a.readAccount().then(function(a){console.log("user : ",a),b.person=a.data})["catch"](function(a){console.log("user not received...",a)})},b.sendEmail=function(){}}),angular.module("crash.crashFinalInfo",[]).controller("CrashFinalInfoController",function(a,b){var c=this;c.finalCrashObj={},c.witnessArr=[],c.crashDriver={},c.loadCrashObj=function(){console.log("CrashEventObj : ",a);var b=a.crashEvent;b.witnessArr&&(c.witnessArr=b.witnessArr),b&&(c.crashDriver=b.crashDriver),c.finalCrashObj=b},c.save=function(){console.log("save final information..."),console.log("final crash object : ",c.finalCrashObj),b.createCrashEvent(c.finalCrashObj).then(function(a){console.log("success data : ",a)})["catch"](function(a){console.log("error saving crash object...",a)})}}),angular.module("crash.crashPhoto",[]).controller("CrashPhotoController",function(a,b,c){function d(){var a=canvas.getContext("2d");if(g&&h){canvas.width=g,canvas.height=h,a.drawImage(video,0,0,g,h);var b=canvas.toDataURL("image/png");photo.setAttribute("src",b),c.uploadImage(b,"scene").then(function(a){e.eventImages.push(a)})["catch"](function(a){console.log("error saving image...",a)})}}var e=this;e.eventImages=[];var f=!1,g=320,h=0;video=document.getElementById("video"),canvas=document.getElementById("canvas"),photo=document.getElementById("photo"),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},function(a){if(navigator.mozGetUserMedia)video.mozSrcObject=a;else{var b=window.URL||window.webkitURL;video.src=b.createObjectURL(a)}video.play()},function(a){console.log("An error occured! "+a)}),video.addEventListener("canplay",function(a){f||(h=video.videoHeight/(video.videoWidth/g),isNaN(h)&&(h=g/(4/3)),video.setAttribute("width",g),video.setAttribute("height",h),canvas.setAttribute("width",g),canvas.setAttribute("height",h),f=!0)},!1),a.takePhoto=function(){d()},e.save=function(){b.crashEvent.eventImages=e.eventImages,console.log("CrashEventObj.crashEvent.images : ",b.crashEvent.eventImages)}}),angular.module("crash.crashWitness",[]).controller("CrashWitnessController",function(a){var b=this;b.witnessArr=[],b.person={},b.personMaster={firstname:"",lastname:"",phoneNumber:"",email:""},b.addWitness=function(){console.log("add witness..."),b.witnessArr.push(b.person),b.person=angular.copy(b.master)},b.save=function(){console.log("saving..."),a.crashEvent.witnessArr=b.witnessArr}}),angular.module("crash.history",[]).controller("HistoryController",function(a){var b=this;b.crashEvents=[],b.getCrashEvents=function(){a.readCrashEvent().then(function(a){console.log("events : ",a),b.crashEvents=a})["catch"](function(a){console.log("ERror getting events...",a)})}}),angular.module("crash.createAccount",[]).controller("CreateAccountController",function(a,b,c){var d=this;d.user={},d.errorMessage="";var e=!1;d.getUser=function(){a.getAccountByUsername("Jia").then(function(a){console.log("user : ",a),d.user=a,a&&(e=!0),console.log("self.user : ",d.user)})["catch"](function(a){console.log("user not received...",a)})},d.createAccount=function(){console.log("create account for user : ",d.user);var f;f=e?a.updateUserAccount(d.user):a.createAccount(d.user),f.then(function(a){console.log("created account, session :",a.token),b.localStorage.setItem("com.crash",a.token),c.path("/")})["catch"](function(a){console.log("Error creating account...",a.data),d.errorMessage=a.data.error,d.user.username=""})}}),angular.module("crash.profile",[]).controller("ProfileController",function(a,b,c){var d=this;d.userObj={},d.getUser=function(){a.readAccount().then(function(a){console.log("user : ",a),d.userObj=a.data})["catch"](function(a){console.log("user not received...",a)})},d.updateUser=function(){a.updateUserAccount(d.userObj).then(function(a){console.log("updated account, session :",a.token),b.localStorage.setItem("com.crash",a.token),c.path("/profile")})["catch"](function(a){console.log("Error updating account...",a.data),d.errorMessage=a.data.error,d.user.username=""})},d.signOut=function(){a.signout()}}),angular.module("crash.signIn",["ngCookies"]).controller("SignInController",function(a,b,c,d){var e=this;e.errorMessage="",e.user={},e.signIn=function(){console.log("sign user in..."),b.signin(e.user).then(function(a){console.log("token : ",a),c.localStorage.setItem("com.crash",a.token),d.path("/")})["catch"](function(a){console.log("Error signing in the user ...",a.data),e.errorMessage=a.data.error,e.user.username="",e.user.password=""})};var f=a.get("token");f&&(c.localStorage.setItem("com.crash",f),d.path("/profile")),e.signInFacebook=function(){b.signinFacebook().then(function(a){console.log("data",a),c.localStorage.setItem("com.crash",a.token),d.path("/profile")})["catch"](function(a){console.log("Error signing in the user ...",a.data)})}});