angular.module("crash",["crash.eventService","crash.userService","crash.S3","crash.sendGrid","crash.crashEventObj","crash.profile","crash.createAccount","crash.signIn","crash.history","crash.crashWitness","crash.crashPhoto","crash.crashDriverSearch","crash.crashDriverInfo","crash.crashEmail","crash.crashFinalInfo","ngRoute","ngCookies"]).config(function(a,b){a.when("/",{templateUrl:"scripts/modules/crash/crashWitness/crashWitness.html",controller:"CrashWitnessController",controllerAs:"crashWitnessCtrl",data:{authenticate:!0}}).when("/profile",{templateUrl:"scripts/modules/user/profile/profile.html",controller:"ProfileController",controllerAs:"profileCtrl",data:{authenticate:!0}}).when("/signin",{templateUrl:"scripts/modules/user/signin/signIn.html",controller:"SignInController",controllerAs:"signInCtrl",data:{authenticate:!1}}).when("/createAccount",{templateUrl:"scripts/modules/user/createAccount/createAccount.html",controller:"CreateAccountController",controllerAs:"createAccountCtrl",data:{authenticate:!1}}).when("/history",{templateUrl:"scripts/modules/history/history.html",controller:"HistoryController",controllerAs:"historyCtrl",data:{authenticate:!0}}).when("/crashPhoto",{templateUrl:"scripts/modules/crash/crashPhoto/crashPhoto.html",controller:"CrashPhotoController",controllerAs:"crashPhotoCtrl",data:{authenticate:!0}}).when("/crashDriverSearch",{templateUrl:"scripts/modules/crash/crashDriverSearch/crashDriverSearch.html",controller:"CrashDriverSearchController",controllerAs:"crashDriverSearchCtrl",data:{authenticate:!0}}).when("/crashDriverInfo",{templateUrl:"scripts/modules/crash/crashDriverInfo/crashDriverInfo.html",controller:"CrashDriverInfoController",controllerAs:"crashDriverInfoCtrl",data:{authenticate:!0}}).when("/crashEmail",{templateUrl:"scripts/modules/crash/crashEmail/crashEmail.html",controller:"CrashEmailController",controllerAs:"crashEmailCtrl",data:{authenticate:!0}}).when("/crashFinalInfo",{templateUrl:"scripts/modules/crash/crashFinalInfo/crashFinalInfo.html",controller:"CrashFinalInfoController",controllerAs:"crashFinalInfoCtrl",data:{authenticate:!0}}).otherwise({redirectTo:"/"}),b.interceptors.push("AttachToken")}).factory("AttachToken",function(a){return{request:function(b){var c=a.localStorage.getItem("com.crash");return c&&(b.headers["x-access-token"]=c),b.headers["Allow-Control-Allow-Origin"]="*",b}}}).run(function(a,b,c,d,e){a.$on("$routeChangeStart",function(a,f,g){e.get("token")&&d.localStorage.setItem("com.crash",e.get("token")),f.$$route&&f.data.authenticate&&!c.isAuthorized()&&b.path("/signin")})}),angular.module("crash.crashEventObj",[]).service("CrashEventObj",function(){this.crashEvent={}}),angular.module("crash.eventService",[]).factory("EventService",function(a){var b=function(b){return a({method:"POST",url:"api/event/create",data:b}).then(function(a){return a.data})},c=function(b){return a({method:"GET",url:"api/event/read"}).then(function(a){return a.data})};return{createCrashEvent:b,readCrashEvent:c}}),angular.module("crash.S3",[]).factory("S3Service",function(a){var b=function(b,c){return a({method:"POST",url:"api/s3/upload",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({imgName:c,imageData:b})}).then(function(a){return a.data})};return{uploadImage:b}}),angular.module("crash.sendGrid",[]).factory("SendGridService",function(a){var b=function(b){return console.log("in sendGrid service"),a({method:"POST",url:"api/sendGrid/sendEmail",data:b}).then(function(a){return a.data})};return{sendEmail:b}}),angular.module("crash.userService",["ngCookies"]).factory("UserService",function(a,b,c,d){var e=function(a){return b({method:"POST",url:"api/user/signin",data:a}).then(function(a){return a.data})},f=function(a){return b({method:"POST",url:"api/user/create",data:a}).then(function(a){return a.data})},g=function(){return b({method:"GET",url:"api/userAction/read"}).then(function(a){return a.data})},h=function(a){return b({method:"POST",url:"api/user/updateuser",data:a}).then(function(a){return a.data})},i=function(a){return b({method:"GET",url:"api/user/read",params:{username:a}}).then(function(a){return a.data})},j=function(){return!!c.localStorage.getItem("com.crash")},k=function(){c.localStorage.clear(),a.remove("token"),a.remove("username"),d.path("/signin")};return{signin:e,createAccount:f,updateUserAccount:h,readAccount:g,signout:k,isAuthorized:j,getAccountByUsername:i}}),angular.module("crash.crashDriverInfo",[]).controller("CrashDriverInfoController",function(a){var b=this;b.person={},b.personMaster={firstname:"",lastname:"",dob:"",phoneNumber:"",email:"",driverLicenseNum:"",insuranceCompany:"",policyNum:"",agentName:"",agentEmail:""},b.save=function(){console.log("saving..."),a.crashEvent.crashDriver=b.person,b.person=b.personMaster}}),angular.module("crash.crashDriverSearch",[]).controller("CrashDriverSearchController",function(a,b){var c=this;c.errorMessage="",c.crashDriver={},c.getUser=function(){var d=c.username;a.getAccountByUsername(d).then(function(a){c.crashDriver=a,b.crashEvent.crashDriver=c.crashDriver,console.log("crash event object : ",b.crashEvent)})["catch"](function(a){console.log("user not received...",a.data),c.errorMessage=a.data.error})}}),angular.module("crash.crashEmail",[]).controller("CrashEmailController",function(a,b){var c=this,d=[];c.insuranceAgentEmail="",c.addEmail=function(){d.push(c.insuranceAgentEmail),c.insuranceAgentEmail=""},c.save=function(){b.crashEvent.userEmailAddresses=d,console.log(b.crashEvent.userEmailAddresses)}}),angular.module("crash.crashFinalInfo",[]).controller("CrashFinalInfoController",function(a,b,c){var d=this;d.finalCrashObj={},d.witnessArr=[],d.crashDriver={},d.loadCrashObj=function(){console.log("CrashEventObj: ",a);var b=a.crashEvent;b.witnessArr&&(d.witnessArr=b.witnessArr),b&&(d.crashDriver=b.crashDriver),d.finalCrashObj=b},d.save=function(){console.log("save final information..."),console.log("final crash object : ",d.finalCrashObj),b.createCrashEvent(d.finalCrashObj).then(function(a){console.log("success data : ",a)})["catch"](function(a){console.log("error saving crash object...",a)})},d.sendGridEmail=function(){c.sendEmail().then(function(a){console.log("success : ",a)})["catch"](function(a){console.log("error : ",a)})}}),angular.module("crash.crashPhoto",[]).controller("CrashPhotoController",function(a,b,c){function d(){var a=canvas.getContext("2d");if(g&&h){canvas.width=g,canvas.height=h,a.drawImage(video,0,0,g,h);var b=canvas.toDataURL("image/png");photo.setAttribute("src",b),c.uploadImage(b,"scene").then(function(a){e.eventImages.push(a)})["catch"](function(a){console.log("error saving image...",a)})}}var e=this;e.eventImages=[];var f=!1,g=320,h=0;video=document.getElementById("video"),canvas=document.getElementById("canvas"),photo=document.getElementById("photo"),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},function(a){if(navigator.mozGetUserMedia)video.mozSrcObject=a;else{var b=window.URL||window.webkitURL;video.src=b.createObjectURL(a)}video.play()},function(a){console.log("An error occured! "+a)}),video.addEventListener("canplay",function(a){f||(h=video.videoHeight/(video.videoWidth/g),isNaN(h)&&(h=g/(4/3)),video.setAttribute("width",g),video.setAttribute("height",h),canvas.setAttribute("width",g),canvas.setAttribute("height",h),f=!0)},!1),a.takePhoto=function(){d()},e.save=function(){b.crashEvent.eventImages=e.eventImages,console.log("CrashEventObj.crashEvent.images : ",b.crashEvent.eventImages)}}),angular.module("crash.crashWitness",[]).controller("CrashWitnessController",function(a,b){var c=this;c.witnessArr=[],c.person={},c.personMaster={firstname:"",lastname:"",phoneNumber:"",email:""},c.addWitness=function(){console.log("add witness..."),c.witnessArr.push(c.person),c.person=angular.copy(c.master)},c.save=function(){console.log("saving..."),a.crashEvent.witnessArr=c.witnessArr},c.sendGrid=function(){console.log("SEND GRID")}}),angular.module("crash.history",[]).controller("HistoryController",function(a){var b=this;b.crashEvents=[],b.getCrashEvents=function(){a.readCrashEvent().then(function(a){console.log("events : ",a),b.crashEvents=a})["catch"](function(a){console.log("ERror getting events...",a)})}}),angular.module("crash.createAccount",["ngCookies"]).controller("CreateAccountController",function(a,b,c,d){var e=this;e.user={},e.errorMessage="";var f=!1;e.getUser=function(){b.getAccountByUsername(a.get("username")).then(function(a){console.log("user : ",a),e.user=a,a&&(f=!0),console.log("self.user : ",e.user)})["catch"](function(a){console.log("user not received...",a)})},e.createAccount=function(){console.log("create account for user : ",e.user);var a;a=f?b.updateUserAccount(e.user):b.createAccount(e.user),a.then(function(a){console.log("created account, session :",a.token),c.localStorage.setItem("com.crash",a.token),d.path("/")})["catch"](function(a){console.log("Error creating account...",a.data),e.errorMessage=a.data.error,e.user.username=""})}}),angular.module("crash.profile",[]).controller("ProfileController",function(a,b,c){var d=this;d.userObj={},d.getUser=function(){a.readAccount().then(function(a){console.log("user : ",a),d.userObj=a.data})["catch"](function(a){console.log("user not received...",a)})},d.updateUser=function(){a.updateUserAccount(d.userObj).then(function(a){console.log("updated account, session :",a.token),b.localStorage.setItem("com.crash",a.token),c.path("/profile")})["catch"](function(a){console.log("Error updating account...",a.data),d.errorMessage=a.data.error,d.user.username=""})},d.signOut=function(){a.signout()}}),angular.module("crash.signIn",["ngCookies"]).controller("SignInController",function(a,b,c,d){var e=this;e.errorMessage="",e.user={},e.signIn=function(){console.log("sign user in..."),b.signin(e.user).then(function(a){console.log("token : ",a),c.localStorage.setItem("com.crash",a.token),d.path("/")})["catch"](function(a){console.log("Error signing in the user ...",a.data),e.errorMessage=a.data.error,e.user.username="",e.user.password=""})},e.signInFacebook=function(){b.signinFacebook().then(function(a){console.log("data",a),c.localStorage.setItem("com.crash",a.token),d.path("/profile")})["catch"](function(a){console.log("Error signing in the user ...",a.data)})}});